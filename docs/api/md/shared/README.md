**@gambit-chess/shared**

***

# Gambit Chess: Shared Module

This module contains the shared types, utilities, and constants used by both the client and server components of Gambit Chess.

## Key Components

- **Types**: Core type definitions for the game
- **DTOs (Data Transfer Objects)**: Structures for client-server communication
- **Constants**: Configuration values and game parameters
- **Chess Utilities**: Chess piece movement patterns and validation
- **Position Utilities**: Board position manipulation and validation
- **Tactical Retreat Calculator**: Implements tactical retreat mechanics
- **Notation System**: Standard chess notation with Gambit Chess extensions

## Directory Structure

```
shared/
├── src/
│   ├── chess/         # Chess movement patterns and validation
│   ├── constants/     # Shared constants and configuration values
│   ├── dtos/          # Data Transfer Objects for communication
│   ├── notation/      # Chess notation utilities
│   ├── tactical/      # Tactical retreat implementation
│   ├── tests/         # Test files
│   ├── types/         # Type definitions 
│   ├── utils/         # Utility functions
│   └── index.ts       # Main entry point
├── dist/              # Compiled output
├── scripts/           # Build and generation scripts
├── package.json       # Package configuration
└── tsconfig.json      # TypeScript configuration
```

## Usage

```typescript
// Import shared components
import { 
  Position, 
  Move, 
  isValidPosition,
  calculateTacticalRetreats,
  PIECE_VALUES
} from '@gambit-chess/shared';
```

## Building

```bash
# Build the shared module
yarn build

# Run tests
yarn test
```

## Domain Boundaries

This shared library strictly adheres to domain boundaries as defined in the project specifications:

- Contains only pure utility functions
- Provides type definitions used by both client and server
- Does not import from client or server code
- Contains no state management or side effects 

### Game State Progression

**Important**: Game state progression logic (checkmate detection, stalemate detection, draw conditions, game termination) is **intentionally not implemented** in the shared layer. This functionality belongs exclusively to the server domain, which serves as the authoritative source of truth for game state.

The shared layer provides:
- Chess piece movement validation
- Board state representation
- Check detection for move validation
- Tactical retreat calculation

But explicitly does not include:
- Checkmate detection
- Stalemate detection
- Draw condition evaluation
- Game termination logic
- Player turn management

This separation ensures proper domain boundaries and prevents duplication of critical game logic.

## Installation

```bash
yarn install
```

## Development

```bash
yarn dev
```

## Testing

Run all tests:

```bash
yarn test
```

Run tests in watch mode:

```bash
yarn test:watch
```

Run tests with coverage:

```bash
yarn test:coverage
```

The coverage report will be available at `coverage/lcov-report/index.html`. You can open it in a browser to see detailed coverage information.

## Documentation

Generate documentation:

```bash
yarn docs
```

## Knight Retreat Table

The knight retreat table is pre-calculated during build time to optimize performance. The table contains all possible knight retreat options for any starting position and attack position.

### Generation

The knight retreat table is generated by `scripts/generateKnightRetreatTable.js` and is executed as part of the prebuild script.

### Usage

To use the knight retreat table, import the utility functions from `constants/knightRetreatUtils`:

```typescript
import { getKnightRetreats } from '../constants/knightRetreatUtils';

// Get knight retreat options
const options = getKnightRetreats(startX, startY, attackX, attackY);
```

## Domain Boundaries

This shared library strictly adheres to domain boundaries as defined in the project specifications:

- Contains only pure utility functions
- Provides type definitions used by both client and server
- Does not import from client or server code
- Contains no state management or side effects
